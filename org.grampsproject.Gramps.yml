app-id: org.grampsproject.Gramps
# flatpak-builder will not take com.gramps-project.Gramps
runtime: org.gnome.Platform//3.36
sdk: org.gnome.Sdk//3.36
writable-sdk: true
command: gramps
finish-args:
# needs home access to access documents and pictures
  - --filesystem=home
# will not work without more extensive bus access
  - --socket=session-bus
# for gui
  - --socket=x11
  - --share=ipc
#needs network access for maps
  - --share=network
modules:
# oracle requires a login to get bsddb

# git wants gnome-common installed
  - name: osmgpsmapDependency
    buildsystem: autotools
    sources:
       - type: archive
         url:  https://github.com/nzjrs/osm-gps-map/releases/download/1.1.0/osm-gps-map-1.1.0.tar.gz
         sha256:  8f2ff865ed9ed9786cc5373c37b341b876958416139d0065ebb785cf88d33586

  - name: exiv2Dependency
    buildsystem: cmake
    sources:
      - type: git
        url:  https://github.com/Exiv2/exiv2

  - name: gexiv2Dependency
    buildsystem: meson
    sources:
      - type: git
        url:  https://gitlab.gnome.org/GNOME/gexiv2

  - name: PyICUDependency
    buildsystem: simple
    ensure-writable:
      - /lib/python3.7/site-packages/easy-install.pth
    build-commands:
      - python3 setup.py install --prefix=/app
    sources:
      - type: archive
        url:  https://files.pythonhosted.org/packages/31/46/fa08c8efae2951e67681ec24319f789fc1a74e2096dd74373e34c79319de/PyICU-2.6.tar.gz
        sha256:  a9a5bf6833360f8f69e9375b91c1a7dd6e0c9157a42aee5bb7d6891804d96371

  - name: GraphVizDependency
    buildsystem: cmake
    sources:
      - type: git
        url: https://gitlab.com/graphviz/graphviz

  - name: GhostscriptDependency
    buildsystem: autotools
    sources:
      - type: git
        url:  https://github.com/ArtifexSoftware/ghostpdl

  - name: Gramps
    buildsystem: simple
    ensure-writable:
      - /lib/python3.7/site-packages/easy-install.pth
    build-commands:
      - python3 setup.py build -build-base=/app
      - python3 setup.py install --prefix=/app --exec-prefix=/bin
      - install -Dm644 /app/share/icons/gramps.png -t /app/share/icons/hicolor/48x48/apps/org.grampsproject.Gramps.png
      - install -Dm644 org.grampsproject.Gramps.desktop -t /app/share/applications/org.grampsproject.Gramps.desktop
    sources:
      - type: archive
        url:  https://github.com/gramps-project/gramps/archive/v5.1.3.tar.gz
        sha256:  91d755b7e407af40ce5ebe24b29baab860bc6e2871ebcbee3f5e109c438df1e8
      - type: file
        path:  org.grampsproject.Gramps.desktop
